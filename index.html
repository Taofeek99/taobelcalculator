<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Taobel Calculator</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#002b55">
  <style>
    :root{
      --bg1:#001936; --bg2:#003a6b; --card: rgba(255,255,255,0.04);
      --accent: #39d0ff; --text:#e8f9ff;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;}
    body{
      background: radial-gradient(1200px 600px at 10% 10%, rgba(57,208,255,0.06), transparent),
                  linear-gradient(135deg,var(--bg1),var(--bg2));
      color:var(--text);
      display:flex;align-items:center;justify-content:center;padding:20px;
    }
    .app{width:380px;max-width:96vw;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.06));
         border-radius:14px;padding:16px;box-shadow:0 12px 30px rgba(2,8,23,0.6);backdrop-filter:blur(6px)}
    header{display:flex;justify-content:space-between;align-items:center}
    h1{margin:0;font-size:18px}
    .display{background:#071a2a;border-radius:10px;padding:12px;margin-top:12px;min-height:68px}
    #expr{font-size:18px;color:#cfeefd;word-break:break-all}
    #res{font-size:26px;color:var(--accent);font-weight:700;margin-top:6px}
    .controls{display:flex;gap:8px;margin-top:12px}
    .controls button{flex:1;padding:10px;border-radius:8px;border:none;background:var(--card);color:var(--text);cursor:pointer}
    .controls button.primary{background:linear-gradient(90deg,#0077cc,#00c6ff);color:#012032;font-weight:600;box-shadow:0 6px 18px rgba(0,198,255,0.12)}
    .keys{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:12px}
    .key{padding:12px;border-radius:8px;background:rgba(255,255,255,0.03);text-align:center;cursor:pointer;user-select:none;box-shadow:inset 0 -2px 0 rgba(0,0,0,0.1)}
    .key.op{background:linear-gradient(90deg,#003d66,#005f99);font-weight:600;color:white}
    .sci-panel{display:none;margin-top:12px;grid-template-columns:repeat(4,1fr);gap:8px}
    footer{margin-top:12px;font-size:12px;color:#cfeefd;text-align:center}
    .small{font-size:12px;opacity:0.95}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Taobel Calculator">
    <header>
      <div>
        <h1>Taobel Calculator</h1>
        <div class="small">Standard â€¢ Scientific (toggle)</div>
      </div>
      <div class="small">Taobel</div>
    </header>

    <div class="display" aria-live="polite">
      <div id="expr">0</div>
      <div id="res"></div>
    </div>

    <div class="controls">
      <button id="btnSpeak" class="primary">ðŸŽ¤ Speak</button>
      <button id="btnToggleSci">Scientific Mode</button>
      <button id="btnTTS">ðŸ”Š Read</button>
      <button id="btnClear">C</button>
    </div>

    <div class="keys" id="keys">
      <div class="key">7</div><div class="key">8</div><div class="key">9</div><div class="key op">/</div>
      <div class="key">4</div><div class="key">5</div><div class="key">6</div><div class="key op">*</div>
      <div class="key">1</div><div class="key">2</div><div class="key">3</div><div class="key op">-</div>
      <div class="key">0</div><div class="key">.</div><div class="key op">=</div><div class="key op">+</div>
    </div>

    <div class="sci-panel" id="sciPanel" aria-hidden="true">
  <button class="key">sin</button>
  <button class="key">cos</button>
  <button class="key">tan</button>
  <button class="key">log</button>
  <button class="key">ln</button>
  <button class="key">âˆš</button>
  <button class="key">Ï€</button>
  <button class="key">(</button>
  <button class="key">)</button>
</div>

    <footer>Offline â€¢ Blue Glow â€¢ Taobel</footer>
  </div>

<script>
(function(){
  const exprEl = document.getElementById('expr');
  const resEl  = document.getElementById('res');
  const sciPanel = document.getElementById('sciPanel');
  const btnSpeak = document.getElementById('btnSpeak');
  const btnToggleSci = document.getElementById('btnToggleSci');
  const btnTTS = document.getElementById('btnTTS');
  const btnClear = document.getElementById('btnClear');

  let expr = '';
  let lastAnswer = '';

  function setExpr(v){ expr = v; exprEl.textContent = expr || '0'; updateResult(); }
  function appendToken(t){ if(expr==='0') expr = t; else expr += t; exprEl.textContent = expr; updateResult(); }
  function clearAll(){ expr=''; setExpr(''); resEl.textContent=''; lastAnswer=''; }

  function safeEval(s){
    if(!s || s.trim()==='') return null;
    try{
      let t = String(s)
        .replace(/Ï€/g, String(Math.PI))
        .replace(/\be\b/g, String(Math.E));
      t = t.replace(/sqrt\(/g, 'Math.sqrt(')
           .replace(/\bln\(/g, 'Math.log(')
           .replace(/\blog\(/g, 'Math.log10(')
           .replace(/\bsin\(/g, 'Math.sin(').replace(/\bcos\(/g,'Math.cos(').replace(/\btan\(/g,'Math.tan(');
      t = t.replace(/(\d+|\))xÂ²/g, function(m){ return m.replace('xÂ²','**2'); });
      t = t.replace(/(\d+|\))xÂ³/g, function(m){ return m.replace('xÂ³','**3'); });
      t = t.replace(/\^/g, '**');
      t = t.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
      t = t.replace(/[^0-9+\-*/().,%Mathpinegslctanobxr**\s]/g, '');
      const fn = new Function('return ('+t+')');
      const v = fn();
      if(typeof v === 'number' && isFinite(v)){
        return Math.round((v + Number.EPSILON) * 1e12) / 1e12;
      }
      return null;
    }catch(e){ return null; }
  }

  function updateResult(){
    const v = safeEval(expr);
    if(v !== null && v !== undefined){ resEl.textContent = v; lastAnswer = String(v); } else resEl.textContent = '';
  }

  // key handlers
  document.querySelectorAll('.key').forEach(k=>{
    k.addEventListener('click', ()=>{
      const txt = k.textContent.trim();
      if(txt === '='){ const v = safeEval(expr); if(v!==null){ expr = String(v); exprEl.textContent = expr; resEl.textContent = v; lastAnswer = String(v);} return; }
      if(txt === 'C'){ clearAll(); return; }
      appendToken(txt);
    });
  });

  btnClear.addEventListener('click', clearAll);
  btnToggleSci.addEventListener('click', ()=>{
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Taobel Voice Calculator</title>
  <meta name="theme-color" content="#007ACC">
  <style>
    :root{
      --bg:#ffffff; --panel:#f6fbff; --accent:#007ACC; --text:#001827;
      --btn-bg:#e6f3ff; --btn-border:rgba(0,0,0,0.06);
    }
    .dark{ --bg:#0b1220; --panel:#07121b; --accent:#39d0ff; --text:#e6f7ff; --btn-bg:#082231; --btn-border:rgba(255,255,255,0.06); }
    .emerald{ --bg: linear-gradient(135deg,#2ecc71,#00bfa5); --panel: rgba(255,255,255,0.03); --accent:#00bfa5; --text:#ffffff; --btn-bg: rgba(255,255,255,0.06); --btn-border: rgba(255,255,255,0.06); }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text);display:flex;align-items:center;justify-content:center;padding:18px;}
    .app{width:380px;max-width:96vw;background:var(--panel);border-radius:14px;padding:14px;box-shadow:0 10px 30px rgba(2,10,20,0.18);position:relative}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    h1{margin:0;font-size:18px}
    .controls{display:flex;gap:8px;align-items:center}
    button.icon{background:transparent;border:none;padding:6px;border-radius:8px;cursor:pointer}
    .display{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;margin-bottom:10px;min-height:66px}
    #expr{font-size:18px; color:var(--text); text-overflow:ellipsis; overflow:hidden; white-space:nowrap;}
    #res{font-size:22px;font-weight:700;color:var(--accent); margin-top:6px}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .key{padding:14px;border-radius:10px;border:1px solid var(--btn-border);background:var(--btn-bg);cursor:pointer;font-weight:600}
    .key.op{background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01));}
    .wide{grid-column:span 2}
    .sci{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:8px}
    footer{margin-top:10px;display:flex;justify-content:space-between;align-items:center;font-size:13px;color:rgba(0,0,0,0.45)}
    .small{font-size:12px;color:rgba(0,0,0,0.5)}
    /* theme overrides for emerald (since it uses gradient bg) */
    .emerald .app{background:rgba(255,255,255,0.03)}
    /* responsive */
    @media (max-width:420px){ .app{width:320px} }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <h1>Taobel Voice Calculator</h1>
      <div class="controls">
        <button id="btnTheme" class="icon" title="Change theme">ðŸŒž</button>
        <button id="btnTTS" class="icon" title="Read result">ðŸ”Š</button>
        <button id="btnSpeak" class="icon" title="Tap to speak">ðŸŽ¤</button>
      </div>
    </header>

    <div class="display" aria-live="polite">
      <div id="expr">0</div>
      <div id="res"></div>
    </div>

    <!-- scientific keys -->
    <div class="sci">
      <button class="key" data-key="sin">sin</button>
      <button class="key" data-key="cos">cos</button>
      <button class="key" data-key="tan">tan</button>

      <button class="key" data-key="log">log</button>
      <button class="key" data-key="ln">ln</button>
      <button class="key" data-key="sqrt">âˆš</button>

      <button class="key" data-key="pi">Ï€</button>
      <button class="key" data-key="^">^</button>
      <button class="key" data-key="%">%</button>
    </div>

    <!-- main buttons -->
    <div class="grid" id="keys">
      <button class="key" data-key="C">C</button>
      <button class="key" data-key="(">(</button>
      <button class="key" data-key=")">)</button>
      <button class="key op" data-key="DEL">DEL</button>

      <button class="key" data-key="7">7</button>
      <button class="key" data-key="8">8</button>
      <button class="key" data-key="9">9</button>
      <button class="key op" data-key="Ã·">Ã·</button>

      <button class="key" data-key="4">4</button>
      <button class="key" data-key="5">5</button>
      <button class="key" data-key="6">6</button>
      <button class="key op" data-key="Ã—">Ã—</button>

      <button class="key" data-key="1">1</button>
      <button class="key" data-key="2">2</button>
      <button class="key" data-key="3">3</button>
      <button class="key op" data-key="-">-</button>

      <button class="key wide" data-key="0">0</button>
      <button class="key" data-key=".">.</button>
      <button class="key op" data-key="+">+</button>

      <button class="key wide" data-key="=" id="equals">=</button>
    </div>

    <footer>
      <div class="small">Voice â€¢ Scientific â€¢ Offline</div>
      <div class="small">Taofeek Bello</div>
    </footer>
  </div>

  <script>
  (function(){
    // Elements
    const appEl = document.getElementById('app');
    const exprEl = document.getElementById('expr');
    const resEl  = document.getElementById('res');
    const btnSpeak = document.getElementById('btnSpeak');
    const btnTTS = document.getElementById('btnTTS');
    const btnTheme = document.getElementById('btnTheme');
    const keys = document.querySelectorAll('[data-key]');

    // state
    let expr = '';
    let ttsEnabled = true;

    // --- Theme handling ---
    const themes = ['light','dark','emerald'];
    function currentTheme(){ return localStorage.getItem('taobel_theme') || 'light'; }
    function applyTheme(name){
      document.documentElement.classList.remove('dark','emerald');
      if(name === 'dark') document.documentElement.classList.add('dark');
      if(name === 'emerald') document.documentElement.classList.add('emerald');
      // update icon
      btnTheme.textContent = name === 'light' ? 'ðŸŒž' : (name === 'dark' ? 'ðŸŒ™' : 'ðŸ’š');
      localStorage.setItem('taobel_theme', name);
    }
    // cycle theme
    btnTheme.addEventListener('click', ()=>{
      const cur = currentTheme();
      const idx = themes.indexOf(cur);
      const next = themes[(idx+1)%themes.length];
      applyTheme(next);
    });
    // apply on load
    applyTheme(currentTheme());

    // --- Display helpers ---
    function setExpr(v){ expr = v === '' ? '' : String(v); exprEl.textContent = expr || '0'; updateResult(); }
    function appendToken(t){ expr += t; exprEl.textContent = expr || '0'; updateResult(); }
    function clearAll(){ expr = ''; exprEl.textContent = '0'; resEl.textContent = ''; }

    // --- Calculation (no unsafe eval global) ---
    function toJsExpression(input){
      // replace easy tokens first
      let s = String(input);
      s = s.replace(/Ã—/g, '*').replace(/Ã·/g, '/').replace(/%/g, '/100');
      s = s.replace(/Ï€/g, 'Math.PI').replace(/âˆš/g, 'Math.sqrt');
      // handle power operator ^ -> **
      s = s.replace(/\^/g, '**');
      // trig/log functions: we expect user to write sin( 30 )
      // replace sin( with Math.sin(Math.PI/180*  etc.
      s = s.replace(/sin\(/g, 'Math.sin(Math.PI/180*');
      s = s.replace(/cos\(/g, 'Math.cos(Math.PI/180*');
      s = s.replace(/tan\(/g, 'Math.tan(Math.PI/180*');
      // log10 and ln
      s = s.replace(/log\(/g, 'Math.log10(');
      s = s.replace(/ln\(/g, 'Math.log(');
      return s;
    }

    function balanceParens(s){
      const open = (s.match(/\(/g) || []).length;
      const close = (s.match(/\)/g) || []).length;
      if(open > close) return s + ')'.repeat(open - close);
      return s;
    }

    function calculate(){
      try{
        if(!expr || expr.trim() === '') return;
        let jsExpr = toJsExpression(expr);
        jsExpr = balanceParens(jsExpr);
        // evaluate safely in local scope
        const result = Function('"use strict"; return (' + jsExpr + ')')();
        if(typeof result === 'number' && isFinite(result)){
          const rounded = Math.round((result + Number.EPSILON) * 1e12) / 1e12;
          resEl.textContent = rounded;
          // reflect on main expression area
          expr = String(rounded);
          exprEl.textContent = expr;
          // speak result (if enabled)
          if(ttsEnabled) speakText('Result is ' + rounded);
        } else {
          resEl.textContent = 'Error';
        }
      }catch(e){
        resEl.textContent = 'Error';
      }
    }

    // update live result (optional preview)
    function updateResult(){
      try{
        let jsExpr = toJsExpression(expr);
        jsExpr = balanceParens(jsExpr);
        const val = Function('"use strict"; return (' + jsExpr + ')')();
        if(typeof val === 'number' && isFinite(val)){
          const rounded = Math.round((val + Number.EPSILON) * 1e12) / 1e12;
          resEl.textContent = rounded;
        } else {
          resEl.textContent = '';
        }
      } catch{
        resEl.textContent = '';
      }
    }

    // --- Buttons handling ---
    keys.forEach(k=>{
      k.addEventListener('click', ()=>{
        const key = k.getAttribute('data-key');
        if(key === 'C'){ clearAll(); return; }
        if(key === 'DEL'){ expr = expr.slice(0,-1); exprEl.textContent = expr || '0'; updateResult(); return; }
        if(key === '='){ calculate(); return; }
        // map special keys
        if(key === 'sqrt'){ appendToken('âˆš'); return; }
        if(key === 'pi'){ appendToken('Ï€'); return; }
        appendToken(key);
      });
    });

    // equals button id=equals (catch Enter by user if present)
    (function(){
      const eq = document.getElementById('equals');
      if(eq) eq.addEventListener('click', calculate);
      // allow keyboard enter
      window.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter') calculate();
      });
    })();

    // --- Speech synthesis (TTS) ---
    function speakText(text){
      try{
        if(!('speechSynthesis' in window)) return;
        const utter = new SpeechSynthesisUtterance(text);
        // try to apply language from local setting if available
        const lang = localStorage.getItem('taobel_lang') || 'en-US';
        utter.lang = lang;
        speechSynthesis.cancel();
        speechSynthesis.speak(utter);
      }catch(e){}
    }
    btnTTS.addEventListener('click', ()=>{ const t = resEl.textContent || 'No result'; speakText('Result is ' + t); });

    // --- Speech recognition (manual tap) ---
    const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(SpeechRec){
      const rec = new SpeechRec();
      rec.lang = localStorage.getItem('taobel_lang') || 'en-US';
      rec.interimResults = false;
      rec.maxAlternatives = 1;
      rec.addEventListener('result', (ev)=>{
        const spoken = ev.results[0][0].transcript.toLowerCase();
        // map common phrases to calculator tokens
        let mapped = spoken.replace(/plus/g,'+')
                           .replace(/minus/g,'-')
                           .replace(/times|multiplied by/g,'*')
                           .replace(/divided by|over/g,'/')
                           .replace(/point/g,'.')
                           .replace(/percent/g,'%')
                           .replace(/pi/g,'Ï€')
                           .replace(/square root of /g,'âˆš(')
                           .replace(/square root /g,'âˆš(')
                           .replace(/sine of /g,'sin(')
                           .replace(/sine /g,'sin(')
                           .replace(/cosine of /g,'cos(')
                           .replace(/cosine /g,'cos(')
                           .replace(/tangent of /g,'tan(')
                           .replace(/tangent /g,'tan(')
                           .replace(/log of /g,'log(')
                           .replace(/ln of /g,'ln(')
                           .replace(/to the power of /g,'^')
                           .replace(/power of /g,'^')
                           .replace(/what is|calculate|equals|equal|please|the/g,'');
        mapped = mapped.trim();
        // auto-close open function parens if user didn't include )
        const openFn = mapped.match(/(sin\(|cos\(|tan\(|âˆš\(|log\(|ln\()/g);
        if(openFn && mapped.indexOf(')') === -1) mapped = mapped + ')';
        // set expression and update
        expr = mapped;
        exprEl.textContent = expr || '0';
        updateResult();
        // speak the result when available
        setTimeout(()=>{ if(resEl.textContent) speakText('Result is ' + resEl.textContent); }, 300);
      });
      // start on button tap
      btnSpeak.addEventListener('click', ()=>{
        try{ rec.start(); }catch(e){}
      });
    } else {
      btnSpeak.disabled = true;
      btnSpeak.title = 'Voice not supported in this browser';
    }

    // register service worker if present
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('service-worker.js').catch(()=>{});
    }

    // on load, set expr to empty or previous?
    setExpr('');

    // export some helpers to window for debugging (optional)
    window.taobel = { setExpr, calculate, applyTheme, speakText, updateResult };

  })();
  </script>
</body>
</html>
